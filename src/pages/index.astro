---
import type { ImageMetadata } from "astro"
import { getCollection } from "astro:content"
import { Image } from "astro:assets"

import { snsLinks, sectionId } from "../data/site.ts"

import Layout from "../layouts/Layout.astro"
import Section from "@/layouts/Section.astro"
import { MenuNav } from "@/components/ui/MenuNav.tsx"

import instagramLogo from "../assets/logo/brandlogo-instagram.png"
import lineLogo from "../assets/logo/brandlogo-line.png"
import xLogo from "../assets/logo/brandlogo-x.png"

import ExternalIcon from "../svg/external-icon.svg"

interface LogoMap {
  [key: string]: ImageMetadata
}

const logoMap: LogoMap = {
  Instagram: instagramLogo,
  X: xLogo,
  LINE: lineLogo,
}

// メニューセクションのデータ 表示順をソート
const menuEntries = await getCollection("menu", ({ data }) => {
  return true
}).then((entries) => entries.sort((a, b) => a.data.order - b.data.order))

// 店舗案内セクションのデータ 表示順をソート
const infoEntries = await getCollection("shopinfo", ({ data }) => {
  return true
}).then((entries) => entries.sort((a, b) => a.data.order - b.data.order))
---

<Layout>
  <main class="container mx-auto grid justify-center grid-cols-1">
    <Section id={sectionId.concept} title="コンセプト" isPaddingX={true}>
      <div>koxnseputo</div>
    </Section>

    <Section id={sectionId.menu.title} title="メニュー" isPaddingX={false}>
      <MenuNav client:load />
      <div id="menu-content" class="px-6 scroll-pt-52 w-full h-auto grid grid-cols-1 gap-12">
        {
          menuEntries.map((entry) => {
            switch (entry.data._type) {
              //やきとん、一品料理
              case "foodList":
                return (
                  <div
                    class="w-full h-auto grid grid-cols-1 gap-8"
                    id={sectionId.menu.blocks.yakiton}
                  >
                    <h3 class="text-3xl font-webfont">{entry.data.title}</h3>
                    {entry.data.title === "やきとん" ? (
                      <div class="border border-primary-foreground text-primary-foreground rounded-xl w-fit px-4 py-3 grid gap-1">
                        <p class="text-xl font-bold">やきとんは、全品390円（税込429円）</p>
                        <p>ご注文は1人前2本になります</p>
                      </div>
                    ) : null}
                    <div class="w-full h-auto grid grid-cols-1 md:grid-cols-2 place-items-start gap-4 md:gap-3 lg:gap-6 px-2">
                      {entry.data.items.map((item) => (
                        <div class="w-full h-full items-start grid content-start gap-2 border border-primary-foreground bg-primary-foreground/1 rounded-xl p-4">
                          <div class="w-full h-full items-center flex justify-between">
                            <span class="text-xl font-webfont">{item.name}</span>
                            {item.price ? (
                              <span class=" font-webfont text-primary-foreground border rounded-xl pl-2 py-1">
                                {Math.floor(item.price * 1.1)}円（税込み）
                              </span>
                            ) : null}
                          </div>
                          <p>{item.description}</p>
                        </div>
                      ))}
                    </div>
                  </div>
                )
              //日本酒
              case "sakeList":
                return (
                  <div class="w-full h-auto grid grid-cols-1 gap-8" id={sectionId.menu.blocks.sake}>
                    <h3 class="text-3xl font-webfontp">{entry.data.title}</h3>
                    <div class="border border-primary-foreground text-primary-foreground rounded-xl w-fit px-4 py-3 grid gap-2">
                      <p>
                        メニューに記載の日本酒は一部です。
                        <br />
                        店主が全国各地から厳選した季節限定酒や入手困難な希少酒も常時取り揃えておりますので、お気軽に店員までお尋ねください。
                      </p>
                      <span class="flex items-center gap-2">
                        <p>日本酒の入荷情報はInstagramをCheck!! →</p>
                        <a
                          href=""
                          rel="noopener noreferrer"
                          class="underline flex items-center gap-1 text-primary font-bold"
                        >
                          <span>Instagram</span>
                          <ExternalIcon />
                        </a>
                      </span>
                    </div>
                    <div class="w-full h-auto grid grid-cols-1 md:grid-cols-2 place-items-start gap-4 md:gap-3 lg:gap-6 px-2">
                      {entry.data.items.map((item) => (
                        <div class="w-full h-full items-start grid content-start gap-2 border border-primary-foreground rounded-xl p-4">
                          <div class="w-full h-full items-center flex justify-between">
                            <span class="text-xl font-webfont">{item.brand}</span>
                            <span class="font-webfont text-primary-foreground border rounded-xl px-2 py-1">
                              {item.prefecture}
                            </span>
                          </div>
                          <ul class="grid grid-cols-1 gap-2 mt-2">
                            {item.items.map((sake) => (
                              <li class="flex justify-between items-center py-1 border-b border-primary-foreground/20">
                                <span>{sake.name}</span>
                                <span class="font-webfont text-primary-foreground">
                                  {Math.floor(sake.price * 1.1)}円（税込み）
                                </span>
                              </li>
                            ))}
                          </ul>
                        </div>
                      ))}
                    </div>
                  </div>
                )
              //ドリンク
              case "drinkList":
                return (
                  <div
                    class="w-full h-auto grid grid-cols-1 gap-8"
                    id={sectionId.menu.blocks.drink}
                  >
                    <h3 class="text-3xl font-webfont">{entry.data.title}</h3>
                    <div class="w-full h-auto grid grid-cols-1 md:grid-cols-2 place-items-start gap-4 md:gap-3 lg:gap-6 px-2">
                      {entry.data.items.map((category) => (
                        <div class="w-full h-full items-start grid content-start gap-2 border border-primary-foreground rounded-xl p-4">
                          <div class="w-full h-full items-center flex justify-between">
                            <span class="text-xl font-webfont">{category.category}</span>
                          </div>
                          <ul class="grid grid-cols-1 gap-2 mt-2">
                            {category.items.map((drink) => (
                              <li class="flex justify-between items-center py-1 border-b border-primary-foreground/20">
                                <span>{drink.name}</span>
                                {drink.price && (
                                  <span class="font-webfont text-primary-foreground">
                                    {Math.floor(drink.price * 1.1)}円（税込み）
                                  </span>
                                )}
                              </li>
                            ))}
                          </ul>
                        </div>
                      ))}
                    </div>
                  </div>
                )
            }
          })
        }
      </div>
    </Section>

    <Section id={sectionId.sns} title="SNS" isPaddingX={true}>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-3xl mx-auto mt-4">
        {
          snsLinks.map((link) => {
            const logo = logoMap[link.name]

            return (
              <a
                href={link.url}
                class="sns-link flex flex-col items-center p-6 rounded-xl border-2 border-primary/30 hover:border-primary transition-all hover:shadow-md bg-background"
                target="_blank"
                rel="noopener noreferrer"
                aria-label={link.ariaLabel}
              >
                <div class="sns-icon bg-primary/10 p-4 rounded-full mb-3">
                  {logo && <Image src={logo} alt={link.ariaLabel} width={50} height={50} />}
                </div>
                <span class="sns-name text-lg font-webfont text-foreground">{link.name}</span>
                <span class="text-sm text-muted-foreground mt-1">フォローする</span>
              </a>
            )
          })
        }
      </div>
    </Section>

    <Section id={sectionId.shopInfo} title="営業のご案内" isPaddingX={true}>
      <div class="w-full max-w-4xl mx-auto">
        {
          infoEntries.map((entry) => {
            switch (entry.data._type) {
              case "detailList":
                return (
                  <div class="mb-8 rounded-xl p-6 bg-background/80 ">
                    <ul class="grid grid-cols-1 gap-4">
                      {entry.data.items.map((item) => (
                        <li class="flex flex-col md:flex-row md:items-center border-b border-primary-foreground/20 pb-4">
                          <div class=" text-lg md:w-1/3">{item.label}</div>
                          <div class="md:w-2/3 mt-1 md:mt-0">{item.detail}</div>
                        </li>
                      ))}
                    </ul>
                  </div>
                )
              case "access":
                return (
                  <div class="rounded-xl overflow-hidden bg-background/80 ">
                    <div class="p-6">
                      <h3 class="text-2xl font-webfont mb-4 border-b border-primary-foreground/20 pb-2">
                        {entry.data.title}
                      </h3>
                      <div class="mb-4">
                        <p class="mb-2">{entry.data.address}</p>
                        <p class="whitespace-pre-line text-muted-foreground">
                          {entry.data.stationInfo}
                        </p>
                      </div>
                    </div>
                    <div class="w-full h-80 rounded-b-xl overflow-hidden">
                      <iframe
                        src={entry.data.mapUrl}
                        class="w-full h-full"
                        style="border:0;"
                        allowfullscreen=""
                        loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade"
                      />
                    </div>
                  </div>
                )
              default:
                return null
            }
          })
        }
      </div>
    </Section>
  </main>
</Layout>
